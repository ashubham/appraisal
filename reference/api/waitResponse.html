<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../assets/style.css?t=615badd5">
    <link rel="stylesheet" href="https://ricostacruz.com/docpress-rsc/style.css">
    <link rel="stylesheet" href="../../assets/custom.css?t=31384f59">
    <script src="../../assets/script.js?t=42463e55"></script>
    <title>waitForResponseToBe - Custody</title>
    <meta name="viewport" content="width=device-width">
  </head>
  <body class="-menu-visible">
    <div class="doc-layout">
      <div class="toggle menu-toggle js-menu-toggle"></div>
      <div class="menu toc-menu">
        <li class="menu-item -level-0 -parent">
          <ul class="submenu">
            <li class="menu-item -level-1"><a class="link title  link-index" href="../../index.html">Custody</a>
            </li>
            <li class="menu-item -level-1 -parent"><span class="title">Quick Start</span>
              <ul class="submenu">
                <li class="menu-item -level-2"><a class="link title  link-starttutorial" href="../../start/tutorial.html">Tutorial</a>
                </li>
              </ul>
            </li>
            <li class="menu-item -level-1 -parent"><span class="title">Reference</span>
              <ul class="submenu">
                <li class="menu-item -level-2"><a class="link title  link-referenceconfig" href="../../reference/config.html">Configuation</a>
                </li>
                <li class="menu-item -level-2 -parent"><span class="title">API Reference</span>
                  <ul class="submenu">
                    <li class="menu-item -level-3"><a class="link title  link-referenceapipostmessage" href="../../reference/api/postMessage.html">postMessage</a>
                    </li>
                    <li class="menu-item -level-3"><a class="link title  link-referenceapiuploadfile" href="../../reference/api/uploadFile.html">uploadFile</a>
                    </li>
                    <li class="menu-item -level-3"><a class="link title  link-referenceapisleep" href="../../reference/api/sleep.html">sleep</a>
                    </li>
                    <li class="menu-item -level-3"><a class="link title  link-referenceapigetlastmessage" href="../../reference/api/getLastMessage.html">getLastMessage</a>
                    </li>
                    <li class="menu-item -level-3"><a class="link title -active link-referenceapiwaitresponse" href="../../reference/api/waitResponse.html">waitForResponseToBe</a>
                      <ul class="headings heading-list">
                        <li class="heading-item -depth-3"><a class="hlink link-waitforresponseoptions" href="#waitforresponseoptions">WaitForResponseOptions</a>
                        </li>
                        <li class="heading-item -depth-3"><a class="hlink link-returns" href="#returns">Returns</a>
                        </li>
                      </ul>
                    </li>
                    <li class="menu-item -level-3"><a class="link title  link-referenceapiwaitfile" href="../../reference/api/waitFile.html">waitForFileShare</a>
                    </li>
                    <li class="menu-item -level-3"><a class="link title  link-referenceapiwait" href="../../reference/api/wait.html">wait</a>
                    </li>
                  </ul>
                </li>
                <li class="menu-item -level-2 -parent"><span class="title">How it works</span>
                  <ul class="submenu">
                    <li class="menu-item -level-3"><a class="link title  link-referencehownormalization" href="../../reference/how/normalization.html">Normalization</a>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </div>
      <div class="body page-referenceapiwaitresponse">
        <div class="header-nav">
          <div class="right"><a class="iconlink" href="https://github.com/ashubham/custody" data-title="ashubham/custody">
              <!-- span.title Open in GitHub--><span class="icon -github"></span></a>
          </div>
        </div>
        <div class="markdown-body"><h1 id="csty.waitforresponsetobe">csty.waitForResponseToBe</h1>
<p>A convenience method which wraps around <code>csty.wait</code> to wait until a message matching the parameter is recieved.</p>
<p>This function blocks Custody&#x2019;s control flow, not the javascript runtime. It will only delay future custody commands from being executed (e.g. it will cause Custody to wait before sending future commands to the chat platform).</p>
<p>Example: Suppose you post a message which asks for a specific reply from the receiver. You can block a Custody client until you get the reply with:</p>
<pre><code class="lang-js">csty.postMessage(<span class="pl-s">&apos;How is the weather today ?&apos;</span>);

csty.waitForResponseToBe({
    <span class="hljs-attr">text</span>: <span class="hljs-regexp">/The weather today is .*/</span>
});
</code></pre>
<p>This method optionally accepts a normalizer to normalize the recieved message before matching. There are default normalizers already implemented, details of their operation can be found here
<a href="../how/normalization.html">here</a>.</p>
<pre><code class="lang-js">csty.postMessage(<span class="pl-s">&apos;help&apos;</span>);
csty.waitForResponseToBe({
    <span class="hljs-attr">numCommands</span>: <span class="hljs-number">5</span>
}, {
    <span class="hljs-attr">additionalNormalizer</span>: <span class="hljs-function">(<span class="hljs-params">src</span>) =&gt;</span> {
        <span class="pl-k">let</span> numCommands = src.attachments.fields.length;
        <span class="pl-k">return</span> {
            numCommands
        };
});
</code></pre>
<table>
<thead>
<tr>
<th>Param</th>
<th style="text-align:center">Type</th>
<th style="text-align:center">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>target</td>
<td style="text-align:center">object|string</td>
<td style="text-align:center">&#x2018;&#x2019;</td>
<td>The target to match against</td>
</tr>
<tr>
<td>opts</td>
<td style="text-align:center"><a href="#waitRespOptions">WaitForResponseOptions</a></td>
<td style="text-align:center"></td>
<td>options</td>
</tr>
</tbody>
</table>
<h3 id="waitforresponseoptions">WaitForResponseOptions</h3>
<table>
<thead>
<tr>
<th>key</th>
<th style="text-align:center">Type</th>
<th style="text-align:center">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>normalizer</td>
<td style="text-align:center">function(input: T) =&gt; T</td>
<td style="text-align:center">undefined</td>
<td>The normalizer method which returns a new object to match against.</td>
</tr>
<tr>
<td>skipNormalization</td>
<td style="text-align:center">boolean</td>
<td style="text-align:center">false</td>
<td>Do not do any normalization, get raw message</td>
</tr>
<tr>
<td>timeout</td>
<td style="text-align:center">number</td>
<td style="text-align:center">config.defaultTimeout</td>
<td>How long to wait for the message.</td>
</tr>
<tr>
<td>receiver</td>
<td style="text-align:center">string</td>
<td style="text-align:center">config.defaultReceiver</td>
<td>The receiver id</td>
</tr>
</tbody>
</table>
<h3 id="returns">Returns</h3>
<table>
<thead>
<tr>
<th>Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Promise&lt;Message&gt;</td>
<td style="text-align:left">A promise that will be fulfilled with the file share message recieved or rejected if it times out waiting.</td>
</tr>
</tbody>
</table>

        </div>
        <div class="footer-nav">
          <div class="left"><a href="../../reference/api/getLastMessage.html"><span class="title">getLastMessage</span></a></div>
          <div class="right"><a href="../../reference/api/waitFile.html"><span class="label">Next: </span><span class="title">waitForFileShare</span></a></div>
        </div>
      </div>
    </div>
  </body>
</html>